# Chapter 03 네트워크 계층

## 03-2 IP 주소

### 개요
이 섹션에서는 인터넷 프로토콜(IP)의 주소 체계에 대해 자세히 살펴봅니다. IP 주소의 구조, 네트워크 주소와 호스트 주소의 개념, 클래스풀 및 클래스리스 주소 체계, 서브넷 마스크와 서브네팅, 공인 IP와 사설 IP의 차이, 그리고 정적 및 동적 IP 할당 방식에 대해 학습합니다. 이를 통해 IP 주소가 인터넷에서 어떻게 할당되고 관리되는지 이해하고, 네트워크 설계 및 문제 해결에 필요한 기본 지식을 습득합니다.

### 네트워크 주소와 호스트 주소

IP 주소는 네트워크 부분(Network Portion)과 호스트 부분(Host Portion)으로 구성됩니다. 이 두 부분은 IP 주소 내에서 특정 비트 경계에 의해 구분됩니다.

1. **네트워크 주소(Network Address)**: IP 주소의 앞부분으로, 장치가 속한 네트워크를 식별합니다. 동일한 네트워크에 있는 모든 장치는 동일한 네트워크 주소를 공유합니다.

2. **호스트 주소(Host Address)**: IP 주소의 뒷부분으로, 해당 네트워크 내에서 특정 장치를 식별합니다. 같은 네트워크 내에서 각 장치는 고유한 호스트 주소를 가져야 합니다.

예를 들어, IP 주소 192.168.1.10에서:
- 네트워크 주소 부분이 192.168.1인 경우, 이 장치는 192.168.1 네트워크에 속합니다.
- 호스트 주소 부분은 10으로, 해당 네트워크 내에서 이 장치를 식별합니다.

네트워크 주소와 호스트 주소를 구분하는 방법은 주소 체계에 따라 다릅니다. 초기에는 클래스풀 주소 체계를 사용했으나, 현재는 클래스리스 주소 체계가 주로 사용됩니다.

### 클래스풀 주소 체계

클래스풀 주소 체계(Classful Addressing)는 IPv4 주소를 5개의 클래스(A, B, C, D, E)로 나누어 관리하는 방식입니다. 각 클래스는 IP 주소의 첫 번째 옥텟(8비트) 값에 따라 구분됩니다.

1. **클래스 A (1 - 126)**:
   - 첫 번째 비트가 0으로 시작
   - 네트워크 부분: 첫 번째 옥텟 (8비트)
   - 호스트 부분: 나머지 3개 옥텟 (24비트)
   - 네트워크 수: 2^7 - 2 = 126개 (0과 127은 특수 용도로 예약)
   - 네트워크당 호스트 수: 2^24 - 2 = 16,777,214개
   - 형식: N.H.H.H (N: 네트워크, H: 호스트)

2. **클래스 B (128 - 191)**:
   - 첫 두 비트가 10으로 시작
   - 네트워크 부분: 첫 번째와 두 번째 옥텟 (16비트)
   - 호스트 부분: 나머지 2개 옥텟 (16비트)
   - 네트워크 수: 2^14 = 16,384개
   - 네트워크당 호스트 수: 2^16 - 2 = 65,534개
   - 형식: N.N.H.H

3. **클래스 C (192 - 223)**:
   - 첫 세 비트가 110으로 시작
   - 네트워크 부분: 첫 번째, 두 번째, 세 번째 옥텟 (24비트)
   - 호스트 부분: 마지막 옥텟 (8비트)
   - 네트워크 수: 2^21 = 2,097,152개
   - 네트워크당 호스트 수: 2^8 - 2 = 254개
   - 형식: N.N.N.H

4. **클래스 D (224 - 239)**:
   - 첫 네 비트가 1110으로 시작
   - 멀티캐스트 주소로 사용
   - 네트워크와 호스트 구분 없음

5. **클래스 E (240 - 255)**:
   - 첫 네 비트가 1111로 시작
   - 실험 및 향후 사용을 위해 예약
   - 네트워크와 호스트 구분 없음

클래스풀 주소 체계의 한계:
- **주소 공간 낭비**: 클래스 A와 B는 너무 많은 호스트 주소를 할당하여 많은 주소가 낭비됩니다.
- **유연성 부족**: 네트워크 크기가 클래스 경계에 맞지 않을 경우 비효율적입니다.
- **라우팅 테이블 확장성 문제**: 인터넷 성장에 따라 라우팅 테이블이 급격히 커지는 문제가 발생합니다.

이러한 한계를 극복하기 위해 클래스리스 주소 체계가 도입되었습니다.

### 클래스리스 주소 체계

클래스리스 주소 체계(Classless Addressing)는 IP 주소를 클래스에 구애받지 않고 더 유연하게 할당하는 방식입니다. 이 체계에서는 서브넷 마스크를 사용하여 네트워크 부분과 호스트 부분을 구분합니다.

#### 서브넷 마스크

서브넷 마스크(Subnet Mask)는 IP 주소에서 네트워크 부분과 호스트 부분을 구분하는 32비트 값입니다. 서브넷 마스크에서:
- 네트워크 부분에 해당하는 비트는 1로 설정
- 호스트 부분에 해당하는 비트는 0으로 설정

예를 들어:
- 255.255.255.0 (이진수: 11111111.11111111.11111111.00000000)은 처음 24비트가 네트워크 부분, 나머지 8비트가 호스트 부분임을 나타냅니다.
- 255.255.240.0 (이진수: 11111111.11111111.11110000.00000000)은 처음 20비트가 네트워크 부분, 나머지 12비트가 호스트 부분임을 나타냅니다.

#### 서브네팅: 비트 AND 연산

IP 주소와 서브넷 마스크의 비트 AND 연산을 통해 네트워크 주소를 구할 수 있습니다. 이 과정을 서브네팅(Subnetting)이라고 합니다.

예시:
- IP 주소: 192.168.10.5 (이진수: 11000000.10101000.00001010.00000101)
- 서브넷 마스크: 255.255.255.0 (이진수: 11111111.11111111.11111111.00000000)
- 비트 AND 연산 결과: 11000000.10101000.00001010.00000000 = 192.168.10.0
- 따라서 네트워크 주소는 192.168.10.0입니다.

서브네팅을 통해 하나의 큰 네트워크를 여러 개의 작은 서브넷으로 분할할 수 있습니다. 이는 네트워크 관리를 용이하게 하고, 브로드캐스트 도메인을 줄여 네트워크 효율성을 높입니다.

#### 서브넷 마스크 표기: CIDR 표기법

CIDR(Classless Inter-Domain Routing) 표기법은 IP 주소와 서브넷 마스크를 간결하게 표현하는 방법입니다. IP 주소 뒤에 슬래시(/)와 네트워크 비트 수를 붙여 표기합니다.

예시:
- 192.168.10.5/24는 IP 주소가 192.168.10.5이고, 서브넷 마스크의 처음 24비트가 1임을 의미합니다 (255.255.255.0).
- 10.0.0.1/8은 IP 주소가 10.0.0.1이고, 서브넷 마스크의 처음 8비트가 1임을 의미합니다 (255.0.0.0).
- 172.16.0.1/16은 IP 주소가 172.16.0.1이고, 서브넷 마스크의 처음 16비트가 1임을 의미합니다 (255.255.0.0).

CIDR 표기법의 장점:
- 간결한 표현
- 클래스 경계에 구애받지 않는 유연한 주소 할당
- 라우팅 테이블 집약을 통한 효율적인 라우팅

### 공인 IP 주소와 사설 IP 주소

IP 주소는 인터넷에서의 사용 범위에 따라 공인 IP 주소와 사설 IP 주소로 구분됩니다.

#### 공인 IP 주소

공인 IP 주소(Public IP Address)는 인터넷 상에서 전 세계적으로 유일하게 할당되는 주소로, 인터넷에 직접 연결된 장치를 식별하는 데 사용됩니다.

특징:
- 인터넷 접속 제공업체(ISP)로부터 할당받거나 구매
- 인터넷 상에서 직접 라우팅 가능
- 전 세계적으로 유일해야 함
- IANA(Internet Assigned Numbers Authority)와 지역 인터넷 레지스트리(RIR)에 의해 관리

#### 사설 IP 주소와 NAT

사설 IP 주소(Private IP Address)는 인터넷에 직접 연결되지 않는 내부 네트워크에서 사용되는 주소입니다. RFC 1918에 의해 다음과 같은 주소 범위가 사설 IP 주소로 예약되어 있습니다:

- 10.0.0.0 - 10.255.255.255 (10.0.0.0/8)
- 172.16.0.0 - 172.31.255.255 (172.16.0.0/12)
- 192.168.0.0 - 192.168.255.255 (192.168.0.0/16)

특징:
- 인터넷에서 직접 라우팅되지 않음
- 내부 네트워크에서만 유효
- 여러 조직에서 동일한 사설 IP 주소 범위를 사용 가능
- 인터넷 접속을 위해 NAT(Network Address Translation) 필요

NAT(Network Address Translation)는 사설 IP 주소를 공인 IP 주소로 변환하는 기술입니다. NAT를 통해 여러 내부 장치가 하나의 공인 IP 주소를 공유하여 인터넷에 접속할 수 있습니다.

NAT의 작동 원리:
1. 내부 장치가 외부로 패킷을 보낼 때, NAT 장치는 사설 IP 주소와 포트를 공인 IP 주소와 새로운 포트로 변환
2. 변환 정보를 NAT 테이블에 저장
3. 외부에서 응답이 오면, NAT 테이블을 참조하여 원래의 사설 IP 주소와 포트로 변환하여 내부 장치에 전달

NAT의 장점:
- IP 주소 절약: 여러 장치가 하나의 공인 IP 주소를 공유
- 보안 강화: 내부 네트워크 구조를 외부에서 직접 볼 수 없음
- 주소 충돌 방지: 서로 다른 조직이 동일한 사설 IP 주소 범위 사용 가능

NAT의 단점:
- 일부 애플리케이션 호환성 문제
- P2P 통신의 어려움
- 연결 추적으로 인한 성능 오버헤드
- 엔드-투-엔드 원칙 위배

### 정적 IP 주소와 동적 IP 주소

IP 주소는 할당 방식에 따라 정적 IP 주소와 동적 IP 주소로 구분됩니다.

#### 정적 할당

정적 IP 주소(Static IP Address)는 장치에 수동으로 할당되어 변경되지 않는 IP 주소입니다.

특징:
- 관리자가 수동으로 구성
- 시간이 지나도 변경되지 않음
- 서버, 라우터, 프린터 등 항상 같은 주소로 접근해야 하는 장치에 적합
- 주소 관리 및 문서화 필요

장점:
- 원격 접속이 용이
- DNS 설정이 안정적
- 특정 서비스 운영에 적합 (웹 서버, 메일 서버 등)

단점:
- 수동 구성으로 인한 관리 부담
- IP 주소 낭비 가능성
- 보안 위험 증가 (항상 같은 주소 사용)

#### 동적 할당과 DHCP

동적 IP 주소(Dynamic IP Address)는 자동으로 할당되며 시간에 따라 변경될 수 있는 IP 주소입니다. 주로 DHCP(Dynamic Host Configuration Protocol)를 통해 할당됩니다.

DHCP의 작동 원리:
1. **DHCP 발견(DHCP Discover)**: 클라이언트가 네트워크에 연결되면 DHCP 서버를 찾기 위해 브로드캐스트 메시지 전송
2. **DHCP 제안(DHCP Offer)**: DHCP 서버가 사용 가능한 IP 주소와 구성 정보를 제안
3. **DHCP 요청(DHCP Request)**: 클라이언트가 제안된 IP 주소 사용을 요청
4. **DHCP 승인(DHCP Acknowledgment)**: DHCP 서버가 요청을 승인하고 IP 주소 임대 시간 등의 정보 제공

DHCP를 통해 할당되는 정보:
- IP 주소
- 서브넷 마스크
- 기본 게이트웨이
- DNS 서버 주소
- 임대 시간(Lease Time)

동적 IP 할당의 장점:
- 자동 구성으로 관리 부담 감소
- IP 주소 풀 효율적 사용
- 장치 이동성 지원
- 대규모 네트워크 관리 용이

동적 IP 할당의 단점:
- 주소 변경으로 인한 원격 접속 어려움
- DNS 업데이트 지연 가능성
- 일부 애플리케이션 호환성 문제

### [좀 더 알아보기] 예약 주소: 0.0.0.0 vs 127.0.0.1

IP 주소 체계에는 특별한 목적으로 예약된 주소들이 있습니다. 그 중에서도 0.0.0.0과 127.0.0.1은 개발자들이 자주 접하는 중요한 예약 주소입니다.

#### 0.0.0.0

0.0.0.0은 "알 수 없는" 또는 "지정되지 않은" 주소를 의미합니다. 이 주소는 다양한 컨텍스트에서 다른 의미를 가집니다:

1. **소스 주소로서의 0.0.0.0**:
   - 아직 IP 주소가 할당되지 않은 호스트를 나타냅니다.
   - DHCP 클라이언트가 IP 주소를 요청할 때 소스 주소로 사용합니다.

2. **목적지 주소로서의 0.0.0.0**:
   - 기본 경로(default route)를 나타냅니다.
   - 라우팅 테이블에서 0.0.0.0/0은 "다른 모든 네트워크"를 의미합니다.

3. **서버 바인딩 컨텍스트에서의 0.0.0.0**:
   - 서버 애플리케이션이 모든 네트워크 인터페이스에서 연결을 수신하도록 바인딩할 때 사용합니다.
   - 예: 웹 서버가 0.0.0.0:80에 바인딩되면 모든 네트워크 인터페이스의 80번 포트에서 연결을 수신합니다.

#### 127.0.0.1 (루프백 주소)

127.0.0.1은 루프백 주소(loopback address)로, 자기 자신을 가리키는 특수한 IP 주소입니다. 사실 127.0.0.0/8 범위 전체(127.0.0.1 ~ 127.255.255.254)가 루프백 용도로 예약되어 있지만, 일반적으로 127.0.0.1이 가장 많이 사용됩니다.

특징:
1. **자기 참조**:
   - 호스트가 자기 자신과 통신할 때 사용합니다.
   - 네트워크 스택은 있지만 물리적 네트워크 인터페이스를 통과하지 않습니다.

2. **로컬 테스트**:
   - 네트워크 애플리케이션을 로컬에서 테스트할 때 유용합니다.
   - 웹 개발자들이 로컬 개발 서버를 실행할 때 자주 사용합니다.

3. **항상 사용 가능**:
   - 네트워크 인터페이스가 비활성화되거나 물리적으로 연결되지 않아도 항상 사용 가능합니다.
   - 네트워크 스택이 정상적으로 작동하는지 테스트하는 데 사용됩니다.

4. **보안**:
   - 루프백 인터페이스로 전송된 트래픽은 외부로 나가지 않으므로 상대적으로 안전합니다.
   - 민감한 서비스를 루프백 인터페이스에만 바인딩하여 외부 접근을 차단할 수 있습니다.

#### 0.0.0.0과 127.0.0.1의 차이점

서버 바인딩 컨텍스트에서:
- **0.0.0.0**: 모든 네트워크 인터페이스에서 연결을 수신합니다. 로컬 머신과 외부 네트워크에서 모두 접근 가능합니다.
- **127.0.0.1**: 루프백 인터페이스에서만 연결을 수신합니다. 로컬 머신에서만 접근 가능하고 외부 네트워크에서는 접근할 수 없습니다.

개발 환경에서:
- 개발 중인 웹 서버를 127.0.0.1에 바인딩하면 로컬에서만 접근 가능합니다.
- 개발 중인 웹 서버를 0.0.0.0에 바인딩하면 같은 네트워크의 다른 장치에서도 접근할 수 있습니다.

### 9가지 키워드로 정리하는 핵심 포인트
1. **IP 주소**: 네트워크 계층에서 장치를 식별하는 논리적 주소로, 네트워크 부분과 호스트 부분으로 구성됨
2. **클래스풀 주소 체계**: IP 주소를 A, B, C, D, E 클래스로 나누어 관리하는 초기 방식으로, 주소 공간 낭비와 유연성 부족 문제가 있음
3. **클래스리스 주소 체계**: 서브넷 마스크를 사용하여 클래스 경계에 구애받지 않고 유연하게 IP 주소를 할당하는 현대적 방식
4. **서브넷 마스크**: IP 주소에서 네트워크 부분과 호스트 부분을 구분하는 32비트 값으로, 1은 네트워크 부분, 0은 호스트 부분을 나타냄
5. **CIDR 표기법**: IP 주소와 서브넷 마스크를 간결하게 표현하는 방법으로, IP 주소 뒤에 슬래시(/)와 네트워크 비트 수를 붙여 표기함
6. **공인 IP 주소**: 인터넷 상에서 전 세계적으로 유일하게 할당되는 주소로, 인터넷에 직접 연결된 장치를 식별하는 데 사용됨
7. **사설 IP 주소**: 인터넷에 직접 연결되지 않는 내부 네트워크에서 사용되는 주소로, NAT를 통해 인터넷에 접속함
8. **정적 IP 할당**: 장치에 수동으로 IP 주소를 할당하는 방식으로, 서버와 같이 항상 같은 주소로 접근해야 하는 장치에 적합함
9. **동적 IP 할당**: DHCP와 같은 프로토콜을 통해 자동으로 IP 주소를 할당하는 방식으로, 관리 부담을 줄이고 IP 주소 풀을 효율적으로 사용함

### 확인 문제
1. 다음 중 네트워크 주소와 호스트 주소에 대한 설명으로 옳지 않은 것은?
   - [ ] 네트워크 주소는 IP 주소의 앞부분으로, 장치가 속한 네트워크를 식별한다
   - [ ] 호스트 주소는 IP 주소의 뒷부분으로, 해당 네트워크 내에서 특정 장치를 식별한다
   - [ ] 서브넷 마스크를 사용하여 네트워크 주소와 호스트 주소를 구분한다
   - [x] 클래스풀 주소 체계에서는 모든 IP 주소의 네트워크 부분과 호스트 부분이 동일한 비트 수를 가진다

2. 다음 중 클래스 C 주소의 특징으로 옳은 것은?
   - [ ] 첫 번째 옥텟이 1에서 126 사이의 값을 가진다
   - [ ] 네트워크 부분이 16비트, 호스트 부분이 16비트이다
   - [x] 네트워크당 최대 254개의 호스트를 가질 수 있다
   - [ ] 멀티캐스트 용도로 사용된다

3. IP 주소 192.168.10.5와 서브넷 마스크 255.255.255.0을 사용할 때, 이 IP 주소가 속한 네트워크 주소는?
   - [ ] 192.168.10.5
   - [x] 192.168.10.0
   - [ ] 192.168.0.0
   - [ ] 255.255.255.0

4. CIDR 표기법 10.0.0.0/16에 대한 설명으로 옳은 것은?
   - [ ] 서브넷 마스크는 255.0.0.0이다
   - [x] 네트워크 부분은 16비트이다
   - [ ] 최대 254개의 호스트를 가질 수 있다
   - [ ] 클래스 C 네트워크에 해당한다

5. 다음 중 사설 IP 주소 범위가 아닌 것은?
   - [ ] 10.0.0.0 - 10.255.255.255
   - [ ] 172.16.0.0 - 172.31.255.255
   - [ ] 192.168.0.0 - 192.168.255.255
   - [x] 169.254.0.0 - 169.254.255.255

6. NAT(Network Address Translation)의 주요 목적이 아닌 것은?
   - [ ] IP 주소 절약
   - [ ] 내부 네트워크 구조 은폐
   - [x] 네트워크 속도 향상
   - [ ] 여러 장치가 하나의 공인 IP 주소를 공유

7. DHCP 프로토콜의 작동 과정 중 올바른 순서는?
   - [x] DHCP Discover → DHCP Offer → DHCP Request → DHCP Acknowledgment
   - [ ] DHCP Request → DHCP Discover → DHCP Offer → DHCP Acknowledgment
   - [ ] DHCP Offer → DHCP Request → DHCP Discover → DHCP Acknowledgment
   - [ ] DHCP Request → DHCP Acknowledgment → DHCP Discover → DHCP Offer

8. 루프백 주소(127.0.0.1)에 대한 설명으로 옳지 않은 것은?
   - [ ] 호스트가 자기 자신과 통신할 때 사용한다
   - [ ] 네트워크 애플리케이션을 로컬에서 테스트할 때 유용하다
   - [x] 다른 네트워크의 호스트와 통신할 때 사용한다
   - [ ] 물리적 네트워크 인터페이스를 통과하지 않는다

9. 서버 애플리케이션이 0.0.0.0에 바인딩되었을 때의 의미는?
   - [ ] 서버가 비활성화되었음을 의미한다
   - [ ] 루프백 인터페이스에서만 연결을 수신한다
   - [x] 모든 네트워크 인터페이스에서 연결을 수신한다
   - [ ] 특정 IP 주소에서만 연결을 수신한다

> [정답 및 해설 보기](../answers_and_explanations.md#03-2-ip-주소)