# Chapter 07 네트워크 심화

## 07-1 안정성을 위한 기술

### 개요

이 섹션에서는 네트워크 시스템의 안정성을 확보하기 위한 다양한 기술과 개념에 대해 알아봅니다. 웹 서비스가 중단 없이 지속적으로 제공되기 위해서는 시스템의 가용성을 높이고, 장애 상황에 대비하는 것이 중요합니다. 이를 위한 이중화, 로드 밸런싱 등의 기술을 살펴보고, 프록시 서버의 역할과 종류에 대해서도 알아보겠습니다.

### 가용성

가용성(Availability)은 시스템이 정상적으로 작동하는 시간의 비율을 의미합니다. 일반적으로 퍼센트로 표현하며, 높을수록 시스템의 신뢰성이 높다고 볼 수 있습니다.

#### 가용성의 중요성

현대 비즈니스 환경에서 웹 서비스의 가용성은 기업의 수익과 직결됩니다. 온라인 쇼핑몰, 금융 서비스, 스트리밍 서비스 등이 중단되면 막대한 손실이 발생할 수 있습니다. 예를 들어, 아마존의 웹사이트가 1시간 동안 다운되면 수백만 달러의 손실이 발생한다고 알려져 있습니다.

#### 가용성 수준과 다운타임

가용성은 보통 "9의 개수"로 표현됩니다:

- 99% (2개의 9): 연간 약 3.65일의 다운타임 허용
- 99.9% (3개의 9): 연간 약 8.76시간의 다운타임 허용
- 99.99% (4개의 9): 연간 약 52.56분의 다운타임 허용
- 99.999% (5개의 9): 연간 약 5.26분의 다운타임 허용

기업의 서비스 특성과 중요도에 따라 적절한 가용성 목표를 설정하고, 이를 달성하기 위한 기술적 방안을 마련해야 합니다.

### 이중화

이중화(Redundancy)는 시스템의 중요 구성 요소를 복수로 구성하여, 일부가 실패하더라도 서비스가 중단되지 않도록 하는 기술입니다.

#### 하드웨어 이중화

하드웨어 이중화는 서버, 네트워크 장비, 전원 공급 장치 등의 물리적 구성 요소를 복수로 구성하는 것을 의미합니다.

- **서버 이중화**: 동일한 기능을 수행하는 서버를 여러 대 운영하여, 한 서버가 실패해도 다른 서버가 서비스를 계속 제공할 수 있도록 합니다.
- **네트워크 장비 이중화**: 스위치, 라우터 등의 네트워크 장비를 이중으로 구성하여 한 장비의 장애가 전체 네트워크에 영향을 미치지 않도록 합니다.
- **전원 이중화**: 여러 개의 전원 공급 장치를 사용하여 전원 장애에 대비합니다. 무정전 전원 공급 장치(UPS)를 설치하는 것도 이에 해당합니다.

#### 소프트웨어 이중화

소프트웨어 이중화는 애플리케이션, 데이터베이스 등의 소프트웨어 구성 요소를 복수로 구성하는 것을 의미합니다.

- **애플리케이션 이중화**: 동일한 애플리케이션을 여러 서버에 배포하여 운영합니다.
- **데이터베이스 이중화**: 주 데이터베이스(Primary)와 보조 데이터베이스(Secondary)를 구성하여, 주 데이터베이스에 문제가 발생하면 보조 데이터베이스로 자동 전환되도록 합니다.
  - **리플리케이션(Replication)**: 주 데이터베이스의 데이터를 보조 데이터베이스에 복제하는 방식입니다.
  - **클러스터링(Clustering)**: 여러 서버가 하나의 데이터베이스처럼 동작하도록 구성하는 방식입니다.

#### 지역적 이중화

지역적 이중화는 물리적으로 다른 위치에 시스템을 구축하여 자연재해나 지역적 장애에 대비하는 것을 의미합니다.

- **재해 복구(Disaster Recovery, DR)**: 주 데이터 센터에 문제가 발생했을 때 다른 지역의 데이터 센터로 서비스를 이전하는 방식입니다.
- **다중 리전 배포**: 클라우드 서비스를 여러 지역(리전)에 배포하여 운영하는 방식입니다.

### 로드 밸런싱

로드 밸런싱(Load Balancing)은 여러 서버에 네트워크 트래픽을 분산하여 시스템의 부하를 균등하게 분배하는 기술입니다. 이를 통해 시스템의 가용성과 확장성을 높일 수 있습니다.

#### 로드 밸런서의 종류

로드 밸런서는 동작하는 네트워크 계층에 따라 다음과 같이 분류할 수 있습니다:

- **L4 로드 밸런서**: 전송 계층(TCP/UDP)에서 동작하며, IP 주소와 포트 정보를 기반으로 트래픽을 분산합니다.
- **L7 로드 밸런서**: 응용 계층(HTTP/HTTPS)에서 동작하며, URL, 쿠키, 헤더 등의 정보를 기반으로 트래픽을 분산합니다. 애플리케이션 로드 밸런서라고도 합니다.

#### 로드 밸런싱 알고리즘

로드 밸런서가 트래픽을 분산하는 방식에는 여러 알고리즘이 있습니다:

- **라운드 로빈(Round Robin)**: 요청을 순차적으로 각 서버에 분배합니다. 가장 단순한 방식입니다.
- **가중치 기반 라운드 로빈(Weighted Round Robin)**: 서버의 처리 능력에 따라 가중치를 부여하여 분배합니다.
- **최소 연결(Least Connection)**: 현재 연결 수가 가장 적은 서버에 요청을 분배합니다.
- **IP 해시(IP Hash)**: 클라이언트의 IP 주소를 해싱하여 항상 같은 서버로 요청을 보내는 방식입니다. 세션 유지에 유용합니다.

#### 헬스 체크

로드 밸런서는 주기적으로 각 서버의 상태를 확인하는 헬스 체크(Health Check)를 수행합니다. 서버에 문제가 발생하면 해당 서버로의 트래픽 전송을 중단하고, 정상 서버로만 트래픽을 분산합니다.

- **능동적 헬스 체크**: 로드 밸런서가 주기적으로 서버에 요청을 보내 응답을 확인합니다.
- **수동적 헬스 체크**: 실제 클라이언트 트래픽의 응답을 모니터링하여 서버 상태를 판단합니다.

### [좀 더 알아보기] 포워드 프록시와 리버스 프록시

프록시 서버는 클라이언트와 서버 사이에서 중개 역할을 하는 서버입니다. 프록시 서버는 용도에 따라 포워드 프록시와 리버스 프록시로 구분됩니다.

#### 포워드 프록시

포워드 프록시(Forward Proxy)는 클라이언트 측에서 사용되며, 클라이언트의 요청을 대신 서버에 전달하고 응답을 받아 클라이언트에게 전달합니다.

- **주요 기능**:
  - **익명성 제공**: 서버는 클라이언트의 실제 IP 주소 대신 프록시 서버의 IP 주소만 볼 수 있습니다.
  - **접근 제어**: 특정 웹사이트에 대한 접근을 제한할 수 있습니다.
  - **캐싱**: 자주 요청되는 콘텐츠를 캐싱하여 응답 시간을 단축하고 대역폭을 절약할 수 있습니다.

- **사용 사례**:
  - 기업 내부 네트워크에서 인터넷 접속 통제
  - 지역 제한 콘텐츠 접근
  - 웹 필터링 및 콘텐츠 차단

#### 리버스 프록시

리버스 프록시(Reverse Proxy)는 서버 측에서 사용되며, 클라이언트의 요청을 받아 내부 서버로 전달하고 응답을 클라이언트에게 전달합니다.

- **주요 기능**:
  - **로드 밸런싱**: 여러 서버에 트래픽을 분산하여 부하를 균등하게 분배합니다.
  - **보안 강화**: 내부 서버의 정보를 숨기고, DDoS 공격 등으로부터 보호합니다.
  - **SSL 종료**: HTTPS 연결을 종료하고 내부적으로는 HTTP로 통신하여 암호화/복호화 부하를 줄입니다.
  - **캐싱 및 압축**: 응답을 캐싱하고 압축하여 성능을 향상시킵니다.

- **사용 사례**:
  - 웹 서버 앞단에서 트래픽 분산
  - 마이크로서비스 아키텍처에서 API 게이트웨이 역할
  - CDN(Content Delivery Network)의 구성 요소

#### 포워드 프록시와 리버스 프록시의 차이점

| 특성 | 포워드 프록시 | 리버스 프록시 |
|------|--------------|--------------|
| 위치 | 클라이언트 측 | 서버 측 |
| 대상 | 클라이언트를 위한 서비스 | 서버를 위한 서비스 |
| 주요 목적 | 클라이언트 익명성, 접근 제어 | 로드 밸런싱, 보안 강화 |
| 클라이언트 인식 | 클라이언트가 프록시 사용을 인식 | 클라이언트는 프록시 사용을 인식하지 못함 |

### 4가지 키워드로 정리하는 핵심 포인트

1. **가용성**: 시스템이 정상적으로 작동하는 시간의 비율로, "9의 개수"로 표현되며 비즈니스 연속성과 사용자 경험에 직접적인 영향을 미치는 중요한 지표입니다.
2. **이중화**: 시스템의 중요 구성 요소를 복수로 구성하여 장애 발생 시에도 서비스가 중단되지 않도록 하는 기술로, 하드웨어, 소프트웨어, 지역적 이중화 등 다양한 수준에서 구현될 수 있습니다.
3. **로드 밸런싱**: 여러 서버에 네트워크 트래픽을 분산하여 시스템의 부하를 균등하게 분배하는 기술로, 다양한 알고리즘을 통해 효율적인 자원 활용과 가용성 향상을 도모합니다.
4. **프록시 서버**: 클라이언트와 서버 사이에서 중개 역할을 하는 서버로, 포워드 프록시는 클라이언트를 위한 서비스를, 리버스 프록시는 서버를 위한 서비스를 제공하여 보안, 성능, 가용성을 향상시킵니다.

### 확인 문제

1. 다음 중 가용성 99.9%는 연간 허용 가능한 다운타임이 얼마인가?
   - [ ] 약 3.65일
   - [x] 약 8.76시간
   - [ ] 약 52.56분
   - [ ] 약 5.26분

2. 로드 밸런싱 알고리즘 중 현재 연결 수가 가장 적은 서버에 요청을 분배하는 방식은?
   - [ ] 라운드 로빈
   - [ ] 가중치 기반 라운드 로빈
   - [x] 최소 연결
   - [ ] IP 해시

3. 다음 중 이중화에 대한 설명으로 옳지 않은 것은?
   - [ ] 하드웨어 이중화는 서버, 네트워크 장비, 전원 공급 장치 등을 복수로 구성하는 것이다.
   - [ ] 데이터베이스 이중화 방식에는 리플리케이션과 클러스터링이 있다.
   - [ ] 지역적 이중화는 자연재해나 지역적 장애에 대비하기 위한 것이다.
   - [x] 이중화는 항상 비용 효율적이므로 모든 시스템 구성 요소에 적용해야 한다.

4. 포워드 프록시와 리버스 프록시의 차이점으로 옳은 것은?
   - [ ] 포워드 프록시는 서버 측에서, 리버스 프록시는 클라이언트 측에서 사용된다.
   - [ ] 포워드 프록시는 로드 밸런싱이 주요 목적이고, 리버스 프록시는 익명성 제공이 주요 목적이다.
   - [x] 포워드 프록시는 클라이언트가 인식하지만, 리버스 프록시는 클라이언트가 인식하지 못한다.
   - [ ] 포워드 프록시와 리버스 프록시는 기능적으로 동일하며 위치만 다르다.

5. 로드 밸런서의 헬스 체크에 대한 설명으로 옳은 것은?
   - [x] 서버의 상태를 확인하여 문제가 있는 서버로의 트래픽 전송을 중단한다.
   - [ ] 클라이언트의 상태를 확인하여 비정상적인 요청을 차단한다.
   - [ ] 네트워크 장비의 상태를 확인하여 대체 경로로 트래픽을 우회시킨다.
   - [ ] 데이터베이스의 상태를 확인하여 백업 데이터베이스로 전환한다.

> [정답 및 해설 보기](../answers_and_explanations.md#07-1-안정성을-위한-기술)